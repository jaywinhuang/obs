{% extends "base-new.html" %}

{% block content %}
    <!-- START PAGE CONTAINER -->
    <div class="container container-boxed">

        <!--
            <div class="alert alert-info alert-icon-block alert-dismissible" role="alert">
                <div class="alert-icon">
                    <span class="icon-question-circle"></span>
                </div>
                We use cookies to offer you the best experience on our website. Continuing browsing, you accept our cookies
                policy.
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span class="fa fa-times"></span>
                </button>
            </div>
            -->

        <div class="row">

            <div class="col-md-6">

                <!-- Accounts -->
                <div class="block block-condensed">
                    <div class="app-heading app-heading-small">
                        <div class="title">
                            <h2>Accounts</h2>
                            <p>List of your personal accounts</p>
                        </div>


                    </div>

                    <div class="block-content">
                        <div id="account-body" class="list-group margin-bottom-15">

                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="app-tip app-tip-runing app-tip-noborder app-tip-lg">
                                    <div class="app-tip-runner">Pay using Devonshire account and get 2% return</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END CARDS -->

                <!-- RECENT ACTIVITY -->
                <div class="block block-condensed">
                    <div class="app-heading app-heading-small margin-bottom-0">
                        <div class="title">
                            <h2>Recent Activity</h2>
                            <p>Your latest account usage</p>
                        </div>
                        <div class="heading-elements" style="width: 150px;">
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <span class="icon-calendar-full"></span>
                                </div>
                                <input type="text" class="form-control bs-datepicker" value="27/06/2017">
                            </div>
                        </div>
                    </div>
                    <div class="block-divider-text"></div>
                    <div class="block-content">
                        <div id="activities-list" class="listing margin-bottom-0">

                        </div>
                    </div>
                    <div class="block-content">
                        <div class="row">
                            <div class="col-md-6 col-md-offset-3 col-sm-12">
                                <a href="/account-activity" class="btn btn-primary btn-clean btn-block">All
                                    Activity</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END RECENT -->

            </div>
            <div class="col-md-6">

                <!-- NEWS -->
                <ul class="app-feature-gallery app-feature-gallery-noshadow">
                    <li>
                        <div class="tile-basic tile-basic-bordered">
                            <div class="tile-content text-center">
                                <h3 class="tile-title">Devonshire purchase with cash back!</h3>
                                <span class="tile-subtitle">News</span>
                                <p>Use your account now to get cash back as you shop!  More than 20 brands and shops! </p>
                                                <img src="../static/img/shop1.png"> &nbsp; <img src="../static/img/shop2.png"> &nbsp;&nbsp;<img src="../static/img/shop3.png"> &nbsp; <a href="#"> And more...</a>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="tile-basic tile-basic-bordered">
                            <div class="tile-content text-center">
                                <h3 class="tile-title">Our new service</h3>
                                <span class="tile-subtitle">Actions</span>
                                <p>Our online services has expand! Now you can apply for loan online now with just one
                                    step.</p>
                                <a href="pages-bank-deposits">Apply now!</a>
                                <p class="text-muted text-center">24.06.2017 14:22</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="tile-basic tile-basic-bordered">
                            <div class="tile-content text-center">
                                <h3 class="tile-title">Changes in our bank</h3>
                                <span class="tile-subtitle">Corporate</span>
                                <p>Cras mattis tortor vitae pulvinar sollicitudin. Aliquam suscipit sed arcu at
                                    tincidunt.
                                    Suspendisse ut massa id odio tristique placerat.</p>
                                <p class="text-muted text-center">23.06.2017 14:22</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="tile-basic tile-basic-bordered">
                            <div class="tile-content text-center">
                                <h3 class="tile-title">New action special for you</h3>
                                <span class="tile-subtitle">Actions</span>
                                <p>Cras mattis tortor vitae pulvinar sollicitudin. Aliquam suscipit sed arcu at
                                    tincidunt.
                                    Suspendisse ut massa id odio tristique placerat.</p>
                                <p class="text-muted text-center">22.06.2017 14:22</p>
                            </div>
                        </div>
                    </li>
                </ul>
                <!-- END NEWS -->

                <!-- TRANSFER -->
                <div class="block block-condensed">
                    <div class="app-heading app-heading-small">
                        <div class="title">
                            <h2>Transfer funds between your accoutns </h2>
                            <p>Devonshire Lending Only</p>
                        </div>
                    </div>

                    <form id="transfer-form" class="block-content" action="" method="post">

                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>From</label>
                                    <select id="fromAccount" name="fromAccount">

                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Recipient</label>
                                        <select id="toAccount" name="toAccount">

                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Amout</label>
                                    <input type="text" class="form-control" id="amount" name="amount"
                                           placeholder="$0.00" required>
                                </div>
                                <div class="col-md-6">
                                    <label>Date</label>
                                    <div class="form-group">
                                        <input type="text" class="form-control bs-datetimepicker">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <a class="btn btn-link pull-left padding-left-0">Information about fee</a>
                            <button type="submit" class="btn btn-primary btn-clean pull-right">Transfer</button>
                        </div>
                    </form>
                    <div id="alertBlock" style="display: none" class="col-md-6">
                        <div class="alert alert-info alert-icon-block alert-dismissible" role="alert">
                            <div class="alert-icon"><span class="icon-clock"></span></div>
                            <div id="alertMessage"></div>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                    class="fa fa-times"></span></button>
                        </div>
                    </div>
                </div>
                <!-- END TRANSFER -->
                <!-- </form> -->
                <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                     aria-hidden="true"
                     id="mi-modal">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                                <div id="parent">
                                    <h3 class="modal-title" id="myModalLabel">Are you sure to make this transfer?</h3>
                                    <p></p>
                                    <h5>From: </h5> <h5 id="fromjs"></h5>
                                    <h5>Recipient: </h5><h5 id="tojs"></h5>
                                    <h5>Amount: </h5><h5 id="amountjs"></h5>
                                    <h5>Currency: </h5><h5 id="currencyjs"></h5>
                                </div>
                                <h4 id="message"> Transfer Success!</h4>
                            </div>
                            <div class="modal-footer" id="modal-button">
                                <button type="button" class="btn btn-default" id="modal-btn-no">No</button>
                                <button type="button" class="btn btn-primary" id="modal-btn-si">Yes</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END TRANSFER -->

                <div class="block block-condensed block-highlight">

                    <div class="app-heading app-heading-small">
                        <div class="icon icon-lg text-blue-400">
                            <span class="icon-question-circle"></span>
                        </div>
                        <div class="title">
                            <h2>FAQs</h2>
                            <p>Frequently asked general questions </p>
                        </div>
                    </div>

                    <div class="app-faq">

                        <div class="app-faq-item">
                            <div class="app-faq-item-title">What information is needed for a bill payment?</div>
                            <div class="app-faq-item-content">
                                <p>Generally, names, account number, phone numbers, address are needed.</p>
                            </div>
                        </div>

                        <div class="app-faq-item">
                            <div class="app-faq-item-title">How much loans can I apply for?</div>
                            <div class="app-faq-item-content">
                                <p>It really depends on your personal information and the loan type you choose.
                                    Generally, our staff will evaluate your credit history, repayment ability and the
                                    loan type you apply for.</p>
                            </div>
                        </div>

                        <div class="app-faq-item">
                            <div class="app-faq-item-title">What information do I need to apply for loans?</div>
                            <div class="app-faq-item-content">
                                <p>Please see more details in our Loans service page, different types of loans have
                                    different requirements.</p>
                            </div>
                        </div>

                        <div class="app-faq-item">
                            <div class="app-faq-item-title">I forget my security question answer, what should I do?
                            </div>
                            <div class="app-faq-item-content">
                                <p>Please contact us as soon as possible or come to our physical branches. We will
                                    verify your personal information and help you to reset the security answer.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- END PAGE CONTAINER -->
{% endblock %}


{% block scripts %}
    <script type="application/javascript">
        function getAccountActivities(accountNumber, lines) {
            $.ajax({
                type: "POST",
                url: "/api/user/account-activities",
                data: {"accountNumber": accountNumber},
                dataType: "json",
                success: function (d) {
                    $("#activities-list").html('');
                    $.each(d.data, function (index, value) {
                        if (index < lines) {
                            printAccountActivities(value);
                        }
                    });
                }
            });
        }

        function printAccountActivities(data) {
            var activitiesInfo = "<div class=\"listing-item listing-item-with-icon\">\n" +
                "                                <span class=\"icon-menu-circle listing-item-icon\"></span>\n" +
                "                                <h4 class=\"text-rg text-bold\">" + data['desc'] + "<span\n" +
                "                                        class=\"text-muted pull-right\">" + data['dateTime'] + "</span></h4>\n" +
                "                                <div class=\"list-group list-group-inline\">\n" +
                "                                    <div class=\"list-group-item col-md-4 col-sm-4\">\n" +
                "                                        <span class=\"text-muted\">Account</span><br>\n" +
                "                                        <span class=\"text-bold\">******" + String(data['accountNumber']).substr(-4) + "</span>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"list-group-item col-md-4 col-sm-4\">\n" +
                "                                        <span class=\"text-muted\">Amount</span><br>\n" +
                "                                        <span class=\"text-bold \">" + accounting.formatMoney(data['amount']) + "</span>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"list-group-item col-md-4 col-sm-4\">\n" +
                "                                        <span class=\"text-muted\">Balance</span><br>\n" +
                "                                        <span class=\"text-bold\">" + accounting.formatMoney(data['balanceSnapshot']) + "</span>\n" +
                "                                    </div>\n" +
                "                                </div>\n" +
                "                            </div>";
            console.log(activitiesInfo)
            $("#activities-list").append(activitiesInfo);
        }

        function printAccount(account_num, balance, type) {
            var accountInfo =
                "                        <a href=\"/account-activity\" class=\"list-group-item list-group-item-highlighted\">\n" +
                "                            <div class=\"row\">\n" +
                "                                <div class=\"col-md-6\">\n" +
                "                                    <h4 class=\"text-rg text-uppercase text-bolder margin-bottom-5\">" + type + " account</h4>\n" +
                "                                    <p class=\"subheader\">******" + String(account_num).substr(-4) + "</p>\n" +
                "                                </div>\n" +
                "                                <div class=\"col-md-6 text-right\">\n" +
                "                                    <h3 class=\"text-rg text-uppercase text-bolder margin-bottom-5\">" + accounting.formatMoney(balance) + "</h3>\n" +
                "                                </div>\n" +
                "                            </div>\n" +
                "                        </a>";
            $("#account-body").append(accountInfo);
        }

        $(function () {

            $.ajax({
                type: "GET",
                url: "/api/user/accounts",
                dataType: "json",
                success: function (data) {
                    if (data.status == 0) {
                        sessionStorage.accounts = JSON.stringify(data.data);
                    } else {
                        alert(data.msg);
                    }
                }
            }).done(function () {
                $.each(JSON.parse(sessionStorage.accounts), function (index, value) {
                    console.log(value['accountNumber'], value['balance'], value['type']);
                    printAccount(value['accountNumber'], value['balance'], value['type']);
                });

                getAccountActivities(1, 4);

                $.when(fillSelectAccounts("fromAccount")).then($("#fromAccount").selectpicker());
                $.when(fillSelectAccounts("toAccount")).then($("#toAccount").selectpicker());

                $("#transfer-form").submit(function (event) {
                    event.preventDefault();

                    $.ajax({
                        url: "/api/user/transfer",
                        type: "POST",
                        data: {
                            "fromAccount": $("#fromAccount").val(),
                            "toAccount": $("#toAccount").val(),
                            "amount": $("#amount").val()
                        },
                        dataType: "json",
                        success: function (d) {
                            if (d.status == 0) {
                                $("#alertMessage").html("Transfer success.")
                            } else {
                                $("#alertMessage").html(d.message)
                                console.log(d.message)
                            }
                            $("#alertBlock").show()
                        }
                    });
                });
            });
        });


    </script>
{% endblock %}